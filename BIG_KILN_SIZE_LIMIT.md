# Ограничение размера для большой печи

## Дата: 2 февраля 2026

## Новое ограничение

### Большая печь: максимальный размер 30×40 см

**Применяется для:**
- ✅ Квадратные формы (`square`)
- ✅ Прямоугольные формы (`rectangle`)

**НЕ применяется для:**
- ❌ Круглые/неправильные формы (`round`)
- ❌ Треугольные формы (`triangle`)

## Логика проверки

### Код проверки:

```typescript
// В kilnCalculations.ts
const MAX_BIG_KILN_LENGTH = 40; // см (максимальная длина)
const MAX_BIG_KILN_WIDTH = 30;  // см (максимальная ширина)

// В функции calculateKilnLoading:
if (kiln.name === 'Большая печь') {
  const shape = productWithShape.shape;
  
  // Проверяем только для квадратных и прямоугольных форм
  if (shape === 'square' || shape === 'rectangle') {
    const maxDimension = Math.max(product.length, product.width);
    const minDimension = Math.min(product.length, product.width);
    
    if (maxDimension > 40 || minDimension > 30) {
      return null; // Не помещается в большую печь
    }
  }
}
```

### Как это работает:

**1. Проверка печи:**
```typescript
if (kiln.name === 'Большая печь')
```
- Ограничение применяется ТОЛЬКО к большой печи
- Малая печь не имеет этого ограничения

**2. Проверка формы:**
```typescript
if (shape === 'square' || shape === 'rectangle')
```
- Ограничение применяется ТОЛЬКО к квадратам и прямоугольникам
- Круглые и треугольные формы не проверяются

**3. Проверка размеров:**
```typescript
const maxDimension = Math.max(product.length, product.width);
const minDimension = Math.min(product.length, product.width);

if (maxDimension > 40 || minDimension > 30)
```
- Большая сторона не должна превышать 40 см
- Меньшая сторона не должна превышать 30 см

## Примеры

### Пример 1: Плитка 30×40 см (прямоугольник)
```
Форма: rectangle
Размеры: 30×40×2 см

Большая печь:
✅ maxDimension = 40 см (≤ 40) ✓
✅ minDimension = 30 см (≤ 30) ✓
✅ Помещается!

Результат: Среднее по обеим печам
```

### Пример 2: Плитка 35×45 см (прямоугольник)
```
Форма: rectangle
Размеры: 35×45×2 см

Большая печь:
❌ maxDimension = 45 см (> 40) ✗
❌ Не помещается!

Малая печь:
✅ Помещается

Результат: Только малая печь
```

### Пример 3: Плитка 32×40 см (прямоугольник)
```
Форма: rectangle
Размеры: 32×40×2 см

Большая печь:
❌ minDimension = 32 см (> 30) ✗
❌ Не помещается!

Малая печь:
✅ Помещается

Результат: Только малая печь
```

### Пример 4: Круглая плитка диаметр 50 см
```
Форма: round
Размеры: 50×50×2 см

Большая печь:
✅ Проверка НЕ применяется (форма круглая)
✅ Попытка расчета (может не поместиться по другим причинам)

Малая печь:
✅ Помещается

Результат: Зависит от расчета загрузки
```

### Пример 5: Квадрат 25×25 см
```
Форма: square
Размеры: 25×25×2 см

Большая печь:
✅ maxDimension = 25 см (≤ 40) ✓
✅ minDimension = 25 см (≤ 30) ✓
✅ Помещается!

Малая печь:
✅ Помещается

Результат: Среднее по обеим печам
```

### Пример 6: Квадрат 35×35 см
```
Форма: square
Размеры: 35×35×2 см

Большая печь:
❌ minDimension = 35 см (> 30) ✗
❌ Не помещается!

Малая печь:
✅ Помещается

Результат: Только малая печь
```

## Взаимодействие с автоповоротом

Программа автоматически пробует обе ориентации:
- 30×40 см
- 40×30 см

И выбирает лучшую загрузку.

**Пример:**
```
Изделие: 30×40×2 см (прямоугольник)

Ориентация 1: 30×40
- maxDimension = 40 см ✓
- minDimension = 30 см ✓
- Помещается ✅

Ориентация 2: 40×30
- maxDimension = 40 см ✓
- minDimension = 30 см ✓
- Помещается ✅

Результат: Программа выберет ориентацию с лучшей загрузкой
```

## Все ограничения большой печи

1. **Столешницы:**
   - ❌ Нельзя обжигать в большой печи
   - ✅ Только малая печь

2. **Размер квадратов/прямоугольников:**
   - ❌ Максимум 30×40 см
   - ✅ Круглые и треугольные формы без ограничения

3. **Высота на ребре:**
   - ❌ Максимум 15 см для всех форм
   - ✅ Применяется к обеим печам

## Размеры печей

### Большая печь
- Рабочая зона: **54×84 см**
- Высота: 150 см (многоуровневая)
- **Ограничение форм: 30×40 см** (квадрат/прямоугольник)

### Малая печь
- Рабочая зона: **95×150 см**
- Одноуровневая
- Без ограничения размера форм

## Результаты расчета

### Если помещается в обе печи:
```
Результат: Среднее арифметическое
Пример: (100 + 120) / 2 = 110 шт
```

### Если помещается только в одну:
```
Результат: Данные этой печи
Причины:
- Столешница → малая печь
- Размер > 30×40 (квадрат/прямоугольник) → малая печь
- Слишком большое изделие → малая печь
```

## Файлы изменены

**`src/utils/kilnCalculations.ts`:**
```typescript
// Добавлены константы
const MAX_BIG_KILN_LENGTH = 40; // см
const MAX_BIG_KILN_WIDTH = 30; // см

// Добавлена проверка в calculateKilnLoading
if (kiln.name === 'Большая печь') {
  if (shape === 'square' || shape === 'rectangle') {
    if (maxDimension > 40 || minDimension > 30) {
      return null;
    }
  }
}
```

## Build статус

✅ **Build успешен**  
✅ **TypeScript**: Без ошибок  
✅ **Bundle**: 171.34 kB (53.51 kB gzipped)

---

**Обновите страницу:** http://localhost:5177/

Теперь большая печь правильно ограничивает квадратные и прямоугольные формы размером 30×40 см!
