# Изменение НДС, брака и добавление кастомных полей

## Дата: 3 февраля 2026

## Выполненные изменения

### 1. НДС изменен на 12%

**Файл:** `src/utils/costCalculations.ts` (строка 18)

**Было:** `VAT_RATE: 0.13, // 13% НДС`  
**Стало:** `VAT_RATE: 0.12, // 12% НДС`

**Обновлено в UI:** `src/components/CostParameters.tsx` (строка 28)  
`<span>НДС (12%):</span>`

### 2. Брак по умолчанию установлен на 10%

**Файл:** `src/utils/costLogic.ts`

#### Брак камня (stoneDefectPercent):
```typescript
export function determineStoneDefectPercent(
  _product: ProductDimensions & { type: ProductType },
  _shape?: TileShape
): number {
  return 10.0; // Было: от 15% до 30% в зависимости от типа
}
```

#### Брак продукции (defectExpensesPercent):
```typescript
export function determineDefectExpensesPercent(
  _productWithType: { type: ProductType; thickness: number },
  _shape?: TileShape
): number {
  return 10.0; // Было: от 15% до 30% в зависимости от типа
}
```

### 3. Добавлены редактируемые поля в расширенном режиме

**Файл:** `src/components/CostParameters.tsx`

#### 3.1. Брак камня - РЕДАКТИРУЕМЫЙ
**Добавлено после строки 38:**
- В hard mode: input поле для редактирования процента
- В simple mode: только отображение значения
- Показывается как процент и стоимость отдельно

```typescript
<div className="param-row">
  <span>Брак камня (%):</span>
  {isHardMode ? (
    <input type="number" step="0.1" min="0" value={parameters.stoneDefectPercent} />
  ) : (
    <span>{parameters.stoneDefectPercent.toFixed(1)}%</span>
  )}
</div>
<div className="param-row">
  <span>Стоимость брака:</span>
  <span>{parameters.stoneDefectCost.toFixed(3)} mil Rp</span>
</div>
```

#### 3.2. Коэффициент ангоба - РЕДАКТИРУЕМЫЙ
**Изменен раздел "Ангоб и глазурь":**
- В hard mode: input поле для редактирования коэффициента
- В simple mode: только отображение значения

```typescript
<div className="param-row">
  <span>Коэффициент:</span>
  {isHardMode ? (
    <input type="number" step="0.1" min="0" value={parameters.angobeCoefficient} />
  ) : (
    <span>{parameters.angobeCoefficient.toFixed(1)}x</span>
  )}
</div>
```

#### 3.3. Прочие расходы - УЛУЧШЕНО
**Изменен раздел "Расходы":**
- Добавлен `min="0"` ко всем полям
- Брак продукции: теперь процент и стоимость показываются отдельно
- Прочие расходы: процент и стоимость показываются отдельно

#### 3.4. Маржа - УЛУЧШЕНО
**Изменен раздел "Маржа":**
- Добавлен `min="0"` к полю ввода
- Улучшена читаемость

## Редактируемые поля в расширенном режиме

### Теперь можно редактировать:

1. **Брак камня (%)** - процент потерь сырья при производстве
2. **Коэффициент ангоба** - множитель для расчета стоимости глазури
3. **Брак продукции (%)** - процент брака готовых изделий
4. **Прочие расходы (%)** - дополнительные расходы
5. **Маржа (%)** - процент маржи для Indonesia

### Не редактируемые (автоматические):

- Цена камня (вводится отдельно)
- НДС (12% - константа)
- Упаковка (рассчитывается автоматически)
- Доставка (0.18 mil Rp - константа)
- Расходы на продажи (рассчитываются автоматически)

## Визуализация интерфейса

### Простой режим:
```
┌────────────────────────────────┐
│ Параметры расчета              │
├────────────────────────────────┤
│ Стоимость камня (на м²)        │
│ • Цена камня: 1.095 mil Rp     │
│ • НДС (12%): 0.131 mil Rp      │
│ • Упаковка: 0.10 mil Rp        │
│ • Доставка: 0.18 mil Rp        │
│ • Брак камня (%): 10.0%        │
│ • Стоимость брака: 0.110       │
│ • Итого: 1.74 mil Rp           │
├────────────────────────────────┤
│ Ангоб и глазурь                │
│ • Базовая: 0.20 mil Rp         │
│ • Коэффициент: 1.0x            │
│ • Итого: 0.20 mil Rp           │
├────────────────────────────────┤
│ Расходы                        │
│ • Брак (%): 10.0%              │
│ • Стоимость: 0.19 mil Rp       │
│ • Продажи: ...                 │
│ • Прочие (%): 5.0%             │
│ • Стоимость: 0.10 mil Rp       │
├────────────────────────────────┤
│ Маржа                          │
│ • Процент маржи (%): 30.0%     │
└────────────────────────────────┘
```

### Расширенный режим:
```
┌────────────────────────────────┐
│ Параметры расчета              │
├────────────────────────────────┤
│ Стоимость камня (на м²)        │
│ • Цена камня: 1.095 mil Rp     │
│ • НДС (12%): 0.131 mil Rp      │
│ • Упаковка: 0.10 mil Rp        │
│ • Доставка: 0.18 mil Rp        │
│ • Брак камня (%): [10.0] ⚡     │ ← РЕДАКТИРУЕТСЯ
│ • Стоимость брака: 0.110       │
│ • Итого: 1.74 mil Rp           │
├────────────────────────────────┤
│ Ангоб и глазурь ⚡              │
│ • Базовая: 0.20 mil Rp         │
│ • Коэффициент: [1.0] ⚡         │ ← РЕДАКТИРУЕТСЯ
│ • Итого: 0.20 mil Rp           │
├────────────────────────────────┤
│ Расходы ⚡                      │
│ • Брак (%): [10.0] ⚡           │ ← РЕДАКТИРУЕТСЯ
│ • Стоимость: 0.19 mil Rp       │
│ • Продажи: ...                 │
│ • Прочие (%): [5.0] ⚡          │ ← РЕДАКТИРУЕТСЯ
│ • Стоимость: 0.10 mil Rp       │
├────────────────────────────────┤
│ Маржа ⚡                        │
│ • Процент маржи (%): [30.0] ⚡  │ ← РЕДАКТИРУЕТСЯ
└────────────────────────────────┘
```

## Сравнение: ДО и ПОСЛЕ

### НДС:
- **Было:** 13% → Для цены 1.095: НДС = 0.142 mil Rp
- **Стало:** 12% → Для цены 1.095: НДС = 0.131 mil Rp
- **Экономия:** 0.011 mil Rp на каждый м²

### Брак камня:
- **Было:** 15-30% (зависело от типа)
- **Стало:** 10% для всех типов
- **Влияние:** Уменьшение стоимости брака камня

### Брак продукции:
- **Было:** 15-30% (зависело от типа)
- **Стало:** 10% для всех типов
- **Влияние:** Уменьшение расходов на брак

## Редактирование в реальном времени

При изменении любого параметра в hard mode:
1. Значение обновляется в state
2. Автоматически пересчитываются все зависимые значения
3. Результаты обновляются мгновенно
4. Показываются новые цены для Indonesia и Abroad

## Примеры использования

### Пример 1: Увеличение брака камня
**Действие:** Изменить "Брак камня" с 10% на 15%  
**Результат:** 
- Стоимость брака увеличится
- Итого камень увеличится
- Финальная цена за м² и штуку увеличится

### Пример 2: Изменение коэффициента ангоба
**Действие:** Изменить коэффициент с 1.0 на 1.5  
**Результат:**
- Стоимость ангоба/глазури: 0.20 × 1.5 = 0.30 mil Rp
- Финальная цена увеличится

### Пример 3: Уменьшение маржи
**Действие:** Изменить маржу с 30% на 25%  
**Результат:**
- Цена продажи для Indonesia уменьшится
- Маржа в деньгах уменьшится
- Продукт станет более конкурентоспособным

## Результат сборки

```
✅ TypeScript compilation: OK
✅ Vite build: OK
✅ CSS: 17.43 kB (3.14 kB gzipped)
✅ JS:  177.87 kB (54.89 kB gzipped)
```

## Измененные файлы

1. ✅ `src/utils/costCalculations.ts` - НДС изменен на 12%
2. ✅ `src/utils/costLogic.ts` - брак по умолчанию 10%
3. ✅ `src/components/CostParameters.tsx` - добавлены редактируемые поля
4. ✅ `src/components/CostParameters.tsx` - обновлено отображение НДС

## Влияние на расчеты

### Для плитки 10×10 см с ценой камня 1.095 mil Rp за м²:

**ДО изменений:**
- НДС: 0.142 mil Rp (13%)
- Брак камня: 0.164-0.328 mil Rp (15-30%)
- Брак продукции: 15-30%

**ПОСЛЕ изменений:**
- НДС: 0.131 mil Rp (12%)
- Брак камня: 0.110 mil Rp (10%)
- Брак продукции: 10%

**Итоговое влияние:** Снижение себестоимости и финальной цены

---

**URL:** http://localhost:5173

Все изменения применены! Обновите страницу в браузере. ✅
