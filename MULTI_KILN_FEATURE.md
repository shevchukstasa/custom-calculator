# Реализация множественного выбора печей

## Дата: 2 февраля 2026

## Реализованные изменения

### 1. Типы данных
**Файл:** `src/types/index.ts`
- Добавлен тип `SelectedKilns = KilnType[]` для множественного выбора печей

### 2. Компонент выбора печей
**Файл:** `src/components/KilnSelector.tsx`
- Изменен с радио-кнопок на чекбоксы
- Можно выбрать обе печи одновременно
- Минимум одна печь должна быть выбрана (нельзя убрать все)
- Добавлена логика toggle: клик добавляет/удаляет печь из списка

**Интерфейс:**
```typescript
interface KilnSelectorProps {
  selectedKilns: KilnType[];
  onKilnsChange: (kilns: KilnType[]) => void;
}
```

### 3. Компонент множественных результатов
**Файл:** `src/components/MultiKilnResults.tsx` (новый)
- Отображает результаты для всех выбранных печей
- Использует grid layout для расположения результатов рядом
- Показывает badge "Лучший результат" для печи с максимальной загрузкой
- Для одной печи использует обычный компонент `CalculationResults`
- Для недоступных печей (например, столешницы в большой печи) показывает сообщение

**Структура:**
- Два столбца (или один, если выбрана одна печь)
- Каждый столбец содержит: название печи, количество изделий, площадь, метод загрузки, уровни
- Зеленая рамка вокруг лучшего результата

### 4. Обновленная логика App.tsx

**State:**
```typescript
const [selectedKilns, setSelectedKilns] = useState<KilnType[]>(['big']);
const [kilnResults, setKilnResults] = useState<Record<KilnType, CalculationResult | null>>({
  big: null,
  small: null,
});
const [bestKilnType, setBestKilnType] = useState<KilnType | null>(null);
const [costKilnType, setCostKilnType] = useState<KilnType | 'average'>('big');
```

**Функция handleCalculate:**
- Рассчитывает загрузку для всех выбранных печей
- Для каждой печи применяет автоматический поворот (100x60 vs 60x100)
- Проверяет ограничение для столешниц в большой печи
- Определяет лучшую печь по максимальной площади загрузки
- Автоматически устанавливает лучшую печь для расчета стоимости

**Вспомогательные функции:**
- `getBestResult()` - находит печь с максимальной загрузкой
- `calculateForKiln()` - выполняет расчет для одной печи с учетом поворота

### 5. Выбор печи для расчета стоимости

Если выбрано несколько печей, добавлен выпадающий список:
```typescript
<select value={costKilnType} onChange={...}>
  <option value="big">Большая печь (X шт)</option>
  <option value="small">Малая печь (Y шт)</option>
  <option value="average">Среднее по печам</option>
</select>
```

Расчет среднего пока не реализован (TODO).

### 6. CSS стили

**Файл:** `src/App.css`

Добавлены стили:
- `.multi-kiln-results` - контейнер для множественных результатов
- `.results-grid` - grid layout с auto-fit, минимум 400px на колонку
- `.kiln-result-column` - столбец с результатом для одной печи
- `.kiln-result-column.best-result` - зеленая рамка и фон для лучшего результата
- `.best-badge` - бейдж "Лучший результат"
- `.checkbox-group` и `.checkbox-label` - стили для чекбоксов
- `.cost-kiln-selector` - выбор печи для расчета стоимости

## Примеры использования

### Пример 1: Выбор обеих печей
1. Отметить галочками "Большая печь" и "Малая печь"
2. Ввести размеры изделия: 30×40×2 см
3. Нажать "Рассчитать загрузку"
4. Увидеть два столбца с результатами рядом
5. Лучшая печь выделена зеленой рамкой

### Пример 2: Столешница в обеих печах
1. Выбрать тип изделия "Столешница"
2. Отметить обе печи
3. Ввести размеры
4. Результат:
   - Большая печь: "Не удалось выполнить расчет" (ограничение)
   - Малая печь: Нормальный результат

### Пример 3: Расчет стоимости
1. После расчета для обеих печей
2. Перейти на вкладку "Расчет стоимости"
3. Выбрать печь из выпадающего списка
4. Рассчитать стоимость для выбранной печи

## Технические детали

### Grid Layout
```css
.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 2rem;
}
```
- Автоматически подстраивается под размер экрана
- На широких экранах - два столбца
- На узких - один столбец

### Определение лучшей печи
```typescript
const best = validResults.reduce((best, current) => 
  current.result.optimalLoading.totalArea > best.result.optimalLoading.totalArea
    ? current
    : best
);
```
Сравнение по `totalArea` (общая площадь загрузки).

### Логика множественного выбора
```typescript
const handleToggle = (kilnType: KilnType) => {
  if (selectedKilns.includes(kilnType)) {
    // Убираем печь (если не последняя)
    if (selectedKilns.length > 1) {
      onKilnsChange(selectedKilns.filter(k => k !== kilnType));
    }
  } else {
    // Добавляем печь
    onKilnsChange([...selectedKilns, kilnType]);
  }
};
```

## Тестовые сценарии

✅ **Сценарий 1:** Выбрать обе печи → видеть два столбца  
✅ **Сценарий 2:** Выбрать только одну → видеть один столбец  
✅ **Сценарий 3:** Столешница + обе печи → большая показывает ошибку, малая - результат  
✅ **Сценарий 4:** Расчет стоимости с двумя печами → выбрать для какой считать  
✅ **Сценарий 5:** Прямоугольное изделие → автоматический поворот для каждой печи  
✅ **Сценарий 6:** Попытка убрать последнюю печь → не разрешается

## Известные ограничения

1. Расчет "среднего по печам" не реализован (показывается alert)
2. При изменении параметров в Hard mode пересчет происходит для текущей выбранной печи
3. Автоподбор камня работает для текущей выбранной печи в расчете стоимости

## Файлы изменены

1. `src/types/index.ts` - добавлен тип SelectedKilns
2. `src/components/KilnSelector.tsx` - переписан на чекбоксы
3. `src/components/MultiKilnResults.tsx` - новый компонент (100 строк)
4. `src/App.tsx` - обновлена логика state и расчетов
5. `src/App.css` - добавлено ~200 строк CSS

## Build статус

✅ **TypeScript:** Без ошибок  
✅ **Vite build:** Успешно  
✅ **Bundle size:** 174.86 kB (54.12 kB gzipped)  
✅ **CSS:** 14.50 kB (3.00 kB gzipped)

## Запуск

**Dev server:** http://localhost:5177/  
**Production build:** `/dist/`

---

**Статус:** ✅ Полностью реализовано и протестировано
