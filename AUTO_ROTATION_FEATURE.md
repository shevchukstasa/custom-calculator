# Функция автоматического поворота изделий

## Дата: 2 февраля 2026

## Реализовано

Программа теперь **автоматически пробует обе ориентации** для прямоугольных изделий и выбирает ту, которая дает **лучшую загрузку** (максимальную площадь).

## Как это работает

### Для квадратных изделий (длина = ширина)
- Расчет выполняется один раз
- Поворот не нужен, так как результат будет одинаковым

**Пример:** 30x30x2 см → рассчитывается один раз

### Для прямоугольных изделий (длина ≠ ширина)
1. **Расчет в исходной ориентации** (например, 60x100x3)
2. **Расчет в повернутой ориентации** (100x60x3)
3. **Сравнение результатов** по общей площади загрузки
4. **Выбор лучшего варианта** автоматически

### Логика выбора

```
if (обе ориентации помещаются) {
  выбрать ориентацию с max(площадь)
} else if (только одна помещается) {
  использовать её
} else {
  показать ошибку
}
```

## Примеры работы

### Пример 1: Изделие 60x100x3 см в малой печи (95x150 см)

**Расчеты:**
- Ориентация 60x100: НЕ помещается (ширина 100 > 95)
- Ориентация 100x60: Помещается ✓

**Результат:** Используется 100x60, загрузка выполнена

### Пример 2: Изделие 10x30x1 см в большой печи (54x84 см)

**Расчеты:**
- Ориентация 10x30: Помещается, например 150 шт (площадь 4.5 м²)
- Ориентация 30x10: Помещается, например 180 шт (площадь 5.4 м²)

**Результат:** Используется 30x10, так как площадь больше

### Пример 3: Изделие 200x300x5 см (слишком большое)

**Расчеты:**
- Ориентация 200x300: НЕ помещается
- Ориентация 300x200: НЕ помещается

**Результат:** Ошибка "не помещается ни в одной ориентации"

## Измененные файлы

### `src/App.tsx` - функция `handleCalculate`

**Было:**
```typescript
let calculationResult = calculateKilnLoading(kiln, productWithType);

// Поворот только при ошибке
if (!calculationResult && product.length !== product.width) {
  const rotatedProduct = { length: product.width, width: product.length, thickness };
  calculationResult = calculateKilnLoading(kiln, rotatedProduct);
}
```

**Стало:**
```typescript
if (product.length === product.width) {
  // Квадратное изделие - один расчет
  calculationResult = calculateKilnLoading(kiln, productWithType);
} else {
  // Прямоугольное - пробуем обе ориентации
  const original = calculateKilnLoading(kiln, productWithType);
  const rotated = calculateKilnLoading(kiln, rotatedWithType);
  
  // Выбираем лучшую по площади
  if (original && rotated) {
    calculationResult = original.optimalLoading.totalArea >= rotated.optimalLoading.totalArea
      ? original
      : rotated;
  } else if (original) {
    calculationResult = original;
  } else if (rotated) {
    calculationResult = rotated;
  }
}
```

## Преимущества

1. **Автоматическая оптимизация**: Не нужно вручную подбирать ориентацию
2. **Максимальная загрузка**: Всегда выбирается вариант с большей площадью
3. **Универсальность**: Работает для любых размеров и любых печей
4. **Прозрачность**: Пользователь видит оптимальный результат без лишних действий

## Ограничения (продолжают работать)

- Максимальная высота для установки на ребро: 15 см
- Столешницы нельзя обжигать в большой печи
- Выбор лучшего метода (на ребре / плашмя) работает автоматически для каждой ориентации

## Тестирование

Протестировано на следующих сценариях:
- ✓ Квадратные изделия
- ✓ Прямоугольные изделия, помещающиеся в обеих ориентациях
- ✓ Прямоугольные изделия, помещающиеся только в одной ориентации
- ✓ Изделия, не помещающиеся ни в одной ориентации

## Запуск

Dev-сервер работает на: **http://localhost:5177/**

Production build собран в: `/dist/`

---

**Статус:** ✅ Реализовано и протестировано
