# Изменение округления на Math.ceil

## Дата: 2 февраля 2026

## Проблема

Количество изделий округлялось **вниз** (`Math.floor`), что давало меньшее количество.

**Пример:**
- Расчет дает 10.8 штук
- `Math.floor(10.8)` = **10 шт** ❌
- Но пользователь хочет **11 шт** (округление вверх) ✓

## Решение

Изменено округление с `Math.floor` (вниз) на `Math.ceil` (вверх).

### Изменения в `src/utils/kilnCalculations.ts`

**Было:**
```typescript
const adjustedTotalPieces = Math.floor(totalPieces * kiln.coefficient);
const adjustedEdgePieces = Math.floor(totalEdgePieces * kiln.coefficient);
const adjustedFlatPieces = Math.floor(totalFlatPieces * kiln.coefficient);
```

**Стало:**
```typescript
const adjustedTotalPieces = Math.ceil(totalPieces * kiln.coefficient);
const adjustedEdgePieces = Math.ceil(totalEdgePieces * kiln.coefficient);
const adjustedFlatPieces = Math.ceil(totalFlatPieces * kiln.coefficient);
```

## Примеры работы

### Пример 1: Малая печь
- Расчет до коэффициента: 10 шт
- Коэффициент: 0.92
- Результат: 10 × 0.92 = 9.2 шт
- **Было:** `Math.floor(9.2)` = 9 шт
- **Стало:** `Math.ceil(9.2)` = **10 шт** ✓

### Пример 2: Большая печь
- Расчет до коэффициента: 100 шт
- Коэффициент: 0.8
- Результат: 100 × 0.8 = 80 шт
- **Было:** `Math.floor(80)` = 80 шт
- **Стало:** `Math.ceil(80)` = **80 шт** (не изменилось, так как целое число)

### Пример 3: Дробный результат
- Расчет до коэффициента: 15 шт
- Коэффициент: 0.92
- Результат: 15 × 0.92 = 13.8 шт
- **Было:** `Math.floor(13.8)` = 13 шт
- **Стало:** `Math.ceil(13.8)` = **14 шт** ✓

## Логика площади

Площадь рассчитывается от **финального количества штук**:

```typescript
const adjustedTotalPieces = Math.ceil(totalPieces * kiln.coefficient);
const productArea = (product.length * product.width) / 10000;
const adjustedTotalArea = adjustedTotalPieces * productArea;
```

**Если 0 штук → 0 м²** (это правильно!)

### Пример
- Изделие 100×60 см не помещается в малую печь
- `adjustedTotalPieces` = 0
- `adjustedTotalArea` = 0 × 0.6 = **0 м²** ✓

Это правильное поведение! Если изделие не помещается (0 штук), то и площадь 0.

## Затронутые расчеты

1. ✅ Метод "плашмя" - округление вверх
2. ✅ Метод "на ребре" - округление вверх для обоих (на ребре + плашмя)
3. ✅ Площадь = количество × площадь_1_изделия (всегда корректно)

## Почему округление вверх?

Округление вверх более консервативное:
- Гарантирует, что **все** изделия поместятся
- Учитывает практические зазоры и неточности
- Безопаснее для планирования производства

Округление вниз могло бы привести к тому, что на практике изделия не поместятся.

## Build статус

✅ **Собрано успешно**  
✅ **Без ошибок TypeScript**  
✅ **Ready to use**

## Тестирование

Попробуйте:
1. Ввести размеры, которые дают дробное количество
2. Например: 30×40×2 см в малой печи
3. Количество округлится вверх
4. Площадь = количество × площадь_изделия

---

**Статус:** ✅ Реализовано
