# Исправление: Селектор печи и ввод цены

## Дата: 3 февраля 2026

## Проблемы

### 1. Селектор печи показывался в простом режиме
**Было:** Селектор печи показывался всегда когда доступно несколько печей  
**Стало:** Селектор показывается только в расширенном режиме

### 2. Невозможно было вводить десятичные числа
**Было:** `value={pricePerSqM.toFixed(3)}` делало поле фактически readonly  
**Стало:** `value={pricePerSqM}` позволяет вводить любые десятичные числа

## Реализованные изменения

### 1. Условный показ селектора печи (App.tsx)

**Файл:** `src/App.tsx` (строка 398-417)

**Добавлено условие для расширенного режима:**
```typescript
{selectedKilns.length > 1 && mode === 'hard' && (
  <div className="cost-kiln-selector">
    // ... селектор печи
  </div>
)}
```

### 2. Информационный блок для простого режима (App.tsx)

**Файл:** `src/App.tsx` (строка 419-433)

**Добавлен новый блок:**
```typescript
{selectedKilns.length > 1 && mode === 'simple' && (
  <div className="cost-kiln-info">
    <h3>Расчет стоимости для:</h3>
    <div className="selected-kiln-display">
      {costKilnType === 'average' ? (
        <span>Среднее по обеим печам</span>
      ) : (
        <span>
          {KILNS[costKilnType as KilnType].name} 
          ({kilnResults[costKilnType as KilnType]?.optimalLoading.totalPieces} шт)
        </span>
      )}
    </div>
  </div>
)}
```

### 3. Исправление инпутов цены (StoneCostInput.tsx)

**Файл:** `src/components/StoneCostInput.tsx` (строки 77-101)

**Изменения:**

#### Для цены за м²:
```typescript
<input
  type="number"
  step="0.001"
  min="0"
  value={pricePerSqM}  // Было: value={pricePerSqM.toFixed(3)}
  onChange={(e) => handlePerSqMChange(parseFloat(e.target.value) || 0)}
  placeholder="1.095"
/>
```

#### Для цены за штуку:
```typescript
<input
  type="number"
  step="0.001"
  min="0"
  value={pricePerPcs}  // Было: value={pricePerPcs.toFixed(3)}
  onChange={(e) => handlePerPcsChange(parseFloat(e.target.value) || 0)}
  placeholder="0.011"
/>
```

**Ключевые изменения:**
- ✅ Удалено `.toFixed(3)` из `value`
- ✅ Добавлено `min="0"` для предотвращения отрицательных значений
- ✅ Поля теперь полностью редактируемые

### 4. CSS стили для информационного блока

**Файл:** `src/App.css` (строки 1115-1137)

```css
.cost-kiln-info {
  background: var(--card-bg);
  padding: 0.75rem;
  border-radius: var(--radius-md);
  margin-bottom: 1rem;
  box-shadow: var(--shadow-sm);
}

.cost-kiln-info h3 {
  font-size: 0.85rem;
  margin: 0 0 0.5rem 0;
  color: var(--text-gray);
}

.selected-kiln-display {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--primary);
  padding: 0.5rem;
  background: rgba(59, 130, 246, 0.1);
  border-radius: var(--radius-sm);
  text-align: center;
}
```

## Как это работает

### Простой режим (mode: 'simple'):

```
┌─────────────────────────────────┐
│ Расчет стоимости для:           │
├─────────────────────────────────┤
│ Среднее по обеим печам          │
│ (или конкретная печь)           │
└─────────────────────────────────┘
```

- ✅ Селектор СКРЫТ
- ✅ Показывается только информация о выбранной печи
- ✅ Выбор происходит автоматически на основе разницы загрузки

### Расширенный режим (mode: 'hard'):

```
┌─────────────────────────────────┐
│ Рассчитать стоимость для:       │
│ ┌─────────────────────────────┐ │
│ │ ▼ Большая печь (892 шт)     │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

- ✅ Селектор ПОКАЗАН
- ✅ Можно вручную выбрать печь
- ✅ По умолчанию выбрана оптимальная печь

## Ввод цены

### Теперь можно вводить:

| Формат | Пример | Описание |
|--------|--------|----------|
| Целые | `1` | Без дробной части |
| С одним знаком | `1.0` | Один знак после запятой |
| С двумя знаками | `1.09` | Два знака после запятой |
| С тремя знаками | `1.095` | Три знака после запятой |
| Минимальное | `0.001` | Минимальное значение |
| Большие числа | `1000.500` | Любые большие значения |

### Примеры ввода:

**Цена за м²:**
- `0.001` → За 1 шт: `0.000` (для маленького изделия)
- `1.095` → За 1 шт: `0.011` (для плитки 10×10 см)
- `10.5` → За 1 шт: `0.105` (для плитки 10×10 см)

**Цена за штуку:**
- `0.011` → За 1 м²: `1.095` (для плитки 10×10 см)
- `0.1` → За 1 м²: `10.000` (для плитки 10×10 см)

## Результат сборки

```
✅ TypeScript compilation: OK
✅ Vite build: OK
✅ CSS: 17.43 kB (3.14 kB gzipped) - увеличился на 0.37 kB
✅ JS:  177.49 kB (54.91 kB gzipped) - практически без изменений
```

## Измененные файлы

1. ✅ `src/App.tsx` - условие показа селектора + информационный блок
2. ✅ `src/components/StoneCostInput.tsx` - исправление инпутов
3. ✅ `src/App.css` - новые стили для информационного блока

## Тестирование

### Сценарий 1: Простой режим
1. Рассчитать загрузку для плитки 10×10 см
2. Перейти на вкладку "Расчет стоимости"
3. **Ожидаемо:** Показан информационный блок "Среднее по обеим печам"
4. **Ожидаемо:** Селектор печи СКРЫТ

### Сценарий 2: Расширенный режим
1. Переключиться на "Расширенный режим"
2. **Ожидаемо:** Показан селектор с выбором печи
3. **Ожидаемо:** По умолчанию выбрана оптимальная печь

### Сценарий 3: Ввод цены
1. Ввести `0.001` в поле "Цена за 1 м²"
2. **Ожидаемо:** Значение принято
3. Ввести `1.095` 
4. **Ожидаемо:** Значение принято
5. Ввести `10.5`
6. **Ожидаемо:** Значение принято

---

**URL:** http://localhost:5173

Все исправления применены и протестированы! ✓
