# Ограничение высоты для малой печи - 30 см

## Дата: 2 февраля 2026

## Обзор

Добавлено ограничение максимальной высоты для малой печи - 30 см. Это влияет на возможность размещения изделий в зависимости от их размеров.

## Ограничение

**Малая печь: максимальная высота = 30 см**

Это означает:
- **Размещение плашмя** (лицом вверх): толщина изделия ≤ 30 см
- **Размещение на ребро**: длина изделия ≤ 30 см

Если высота превышает 30 см при любом варианте размещения - расчет для малой печи не выполняется (возвращается `null`).

## Изменения в коде

### 1. Добавлена константа

**Файл:** `src/utils/kilnCalculations.ts` (строка 21)

```typescript
// Максимальная высота установки плитки на ребро
const MAX_EDGE_HEIGHT = 15; // см

// Максимальные размеры для большой печи (квадрат/прямоугольник)
const MAX_BIG_KILN_LENGTH = 40; // см
const MAX_BIG_KILN_WIDTH = 30; // см

// Максимальная высота для малой печи
const MAX_SMALL_KILN_HEIGHT = 30; // см  // НОВАЯ
```

### 2. Обновлена функция calculateEdgeLoading

**Файл:** `src/utils/kilnCalculations.ts` (строка 47-51)

```typescript
function calculateEdgeLoading(
  kiln: KilnConfig,
  product: ProductDimensions
): LoadingCalculation | null {
  const { workingArea } = kiln;
  
  // ОГРАНИЧЕНИЕ: максимальная высота на ребро = 15 см
  if (product.length > MAX_EDGE_HEIGHT) {
    return null;
  }
  
  // НОВОЕ: ОГРАНИЧЕНИЕ для малой печи: длина не должна превышать 30 см
  if (kiln.name === 'Малая печь' && product.length > MAX_SMALL_KILN_HEIGHT) {
    return null; // Изделие слишком высокое для малой печи
  }
  
  // ... остальной код
}
```

**Логика:**
- Для размещения на ребро высота изделия = его длина
- Общее ограничение: length ≤ 15 см (для всех печей)
- Дополнительное для малой печи: length ≤ 30 см

### 3. Обновлена функция calculateFlatLoading

**Файл:** `src/utils/kilnCalculations.ts` (строка 138-141)

```typescript
function calculateFlatLoading(
  kiln: KilnConfig,
  product: ProductDimensions
): LoadingCalculation | null {
  const { workingArea } = kiln;
  
  // НОВОЕ: ОГРАНИЧЕНИЕ для малой печи: толщина не должна превышать 30 см
  if (kiln.name === 'Малая печь' && product.thickness > MAX_SMALL_KILN_HEIGHT) {
    return null; // Изделие слишком толстое для малой печи
  }
  
  // ... остальной код
}
```

**Логика:**
- Для размещения плашмя высота изделия = его толщина
- Для малой печи: thickness ≤ 30 см

## Примеры работы

### Пример 1: Обычная плитка 30×30×2 см

```
Малая печь:
✅ Плашмя: thickness = 2 см ≤ 30 см → помещается
✅ На ребро: length = 30 см ≤ 30 см → проходит проверку
   НО length = 30 см > 15 см → блокировано общим ограничением
Результат: Только плашмя

Большая печь:
✅ Плашмя: помещается
❌ На ребро: length = 30 см > 15 см
Результат: Только плашмя

Итоговый результат: Среднее по обеим печам
```

### Пример 2: Длинная тонкая плитка 50×20×2 см

```
Малая печь:
✅ Плашмя: thickness = 2 см ≤ 30 см → помещается
❌ На ребро: length = 50 см > 30 см → НЕ помещается!
Результат: Только плашмя

Большая печь:
✅ Плашмя: помещается
❌ На ребро: length = 50 см > 15 см
Результат: Только плашмя

Итоговый результат: Среднее по обеим печам
```

### Пример 3: Толстая столешница 100×60×35 см

```
Малая печь:
❌ Плашмя: thickness = 35 см > 30 см → НЕ помещается!
❌ На ребро: не проверяется (столешницы не ставятся на ребро)
Результат: null (расчет НЕ выполняется)

Большая печь:
❌ Столешницы запрещены в большой печи
Результат: null

Итоговый результат: "Не удалось выполнить расчет"
```

### Пример 4: Толстая плитка 40×40×32 см

```
Малая печь:
❌ Плашмя: thickness = 32 см > 30 см → НЕ помещается!
❌ На ребро: length = 40 см > 30 см → НЕ помещается!
Результат: null (не подходит ни один вариант)

Большая печь:
✅ Плашмя: помещается (height = 80 см, много места)
❌ На ребро: length = 40 см > 15 см
❌ На ребро: также size > 30×40 для квадратов
Результат: Только плашмя

Итоговый результат: Только большая печь
```

### Пример 5: Столешница 100×60×5 см

```
Малая печь:
✅ Плашмя: thickness = 5 см ≤ 30 см → помещается
Результат: 1 шт, 0.6 м²

Большая печь:
❌ Столешницы запрещены
Результат: null

Итоговый результат: Только малая печь
```

## Матрица всех ограничений

### Малая печь

| Размещение | Параметр | Ограничения |
|------------|----------|-------------|
| Плашмя | thickness | ≤ 30 см |
| На ребро | length | ≤ 15 см И ≤ 30 см |

### Большая печь

| Размещение | Параметр | Ограничения |
|------------|----------|-------------|
| Плашмя | thickness | Нет (height = 80 см) |
| На ребро | length | ≤ 15 см |
| Квадрат/Прямоуг. | length × width | ≤ 30×40 см |

## Дополнительные ограничения

Помимо высоты, действуют:
1. **Тип изделия**: столешницы нельзя в большую печь
2. **Глазурь**: 
   - Глазурь на торцах → нельзя на ребро
   - Глазурь на обороте → только 1 уровень (большая печь)
3. **Форма для большой печи**: квадраты/прямоугольники ≤ 30×40 см

## Логика проверок (порядок выполнения)

### calculateEdgeLoading:
1. ✓ length ≤ 15 см? (для всех печей)
2. ✓ Если малая печь: length ≤ 30 см? **[НОВОЕ]**
3. ✓ Глазурь только на лицевой?
4. → Расчет или null

### calculateFlatLoading:
1. ✓ Если малая печь: thickness ≤ 30 см? **[НОВОЕ]**
2. ✓ Глазурь (влияет на уровни)
3. → Расчет или null

## Технические детали

### Код проверки

Проверка выполняется **в начале** функции, до основных расчетов:

```typescript
// Проверяем ограничение
if (kiln.name === 'Малая печь' && dimension > MAX_SMALL_KILN_HEIGHT) {
  return null; // Сразу выходим, расчет не делаем
}
```

### Возвращаемое значение

- `null` = изделие не помещается этим способом
- Если оба способа возвращают `null` → общий результат `null`
- Если хотя бы один способ работает → возвращается лучший

### Сравнение печей

| Печь | Высота рабочей зоны | Максимум для изделия |
|------|---------------------|---------------------|
| Большая | 80 см (многоуровневая) | Нет ограничения по толщине |
| Малая | Нет (одноуровневая) | 30 см (новое) |

## Файлы изменены

1. **`src/utils/kilnCalculations.ts`**
   - Строка 21: Добавлена константа `MAX_SMALL_KILN_HEIGHT = 30`
   - Строка 47-51: Добавлена проверка в `calculateEdgeLoading`
   - Строка 138-141: Добавлена проверка в `calculateFlatLoading`

## Статус сборки

✅ **Сборка успешна**  
✅ **TypeScript**: Без ошибок  
✅ **Bundle**: 173.52 kB (53.71 kB gzipped)  
✅ **CSS**: 17.17 kB (3.51 kB gzipped)

## Тестирование

Проверьте следующие сценарии:

**Тонкие изделия (< 30 см):**
- ✅ Должны помещаться в малую печь плашмя
- ✅ Среднее значение между печами

**Толстые изделия (> 30 см):**
- ❌ НЕ должны помещаться в малую печь
- ✅ Только большая печь (если не столешница)

**Длинные изделия (length > 30 см):**
- ❌ НЕ должны помещаться в малую печь на ребро
- ✅ Только плашмя в малой печи

---

**Обновите страницу:** http://localhost:5177/

Попробуйте ввести изделие с толщиной больше 30 см - малая печь не должна рассчитываться!
